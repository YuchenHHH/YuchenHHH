---
title: 指针
date: 2021-11-30 15:41:01
tags:
---

## 指针步长
指针步长指指针变量 +1 后跳跃的字节数

```C
void test()
{
    char *p = nullptr;
    printf("%d\n", p);     // 0
    printf("%d\n", p + 1); // 1

    double *q = nullptr;
    printf("%d\n", q);     // 0
    printf("%d\n", q + 1); // 8
}
```

也是指针在解引用时取出的字节数
```C
void test()
{
    char buf[1024] = "";
    int a = 1000;
    memcpy(buf, &a, sizeof(int));

    char *p = buf;
    printf("%d\n", *(int *)p); // 解引用 4 个字节, 结果为 1000
}
```

在结构体中, 可以用 offsetof(s, m) 宏函数来取得成员的偏移量, 头文件 stddef.h
```C
struct Person
{
    char a;       // 0 - 3
    int b;        // 4 - 7
    char buf[64]; // 8 - 71
    int d;        // 72-75
};

void test02()
{
    struct Person p = {'a', 10, "Hello, world", 1000}; // 初始化
    // p 中的 d 属性偏移量是多少?
    printf("d 的漂移量是 %ld\n", offsetof(struct Person, d));
    printf("d 的值为 %d\n", *(int *)((char *)&p + offsetof(struct Person, d)));
}
```

## 指针做函数参数

- 输入: 主调函数分配内存
- 输出: 被调函数分配内存

```C
void func(char *p)
{
    strcpy(p, "hello, world");
}

void test()
{
    char buf[1024] = {0}; // 栈区分配内存
    func(buf);
    printf("%s\n", buf);
    char *p = (char *)malloc(sizeof(char) * 64); // 堆区分配内存
    memset(p, 0, 64);
    func(p);
    printf("%s\n", p);
}
```